#!/usr/bin/env bash

# exit script if a command fails
set -e

# get root priveleges
sudo -v

# dotfiles root dir environment variable
export DOTFILES_ROOT=${HOME}/.dotfiles
[[ -a ${HOME}/.localrc ]] && source ${HOME}/.localrc &> /dev/null
[ ! -d "$DOTFILES_ROOT" ] && echo "ERROR: dotfiles root directory ($DOTFILES_ROOT) was not found." && return

cd ${DOTFILES_ROOT}

# check os and install accordingly
if test "$(uname)" = "Darwin"; then
    sudo sh macos/install.sh
elif test "$(uname)" = "Linux"; then
    sudo sh linux/install.sh
else
    echo "os must be darwin (macos) or linux"
    exit 1
fi

# run setup.sh files
for file in $(find -H "$DOTFILES_ROOT" -maxdepth 2 -name 'setup.sh' -not -path '*.git*'); do
    sh $file
done

# symlink dotfiles
./dotfiles
