#!/usr/bin/env bash

# exit script if a command fails
set -e

### dotfiles root path
export DOTFILES_ROOT=${HOME}/.dotfiles
[[ -a ${HOME}/.localrc ]] && source ${HOME}/.localrc &> /dev/null
[ ! -d "$DOTFILES_ROOT" ] && echo "ERROR: dotfiles root directory ($DOTFILES_ROOT) was not found." && return
cd ${DOTFILES_ROOT}

### check os and install accordingly
echo "    Would you like to run the operating system install script? (y/n): "
read input
input="${input:0:1}"
if [ "$input" = "y" ]; then
    if test "$(uname)" = "Darwin"; then
        sudo bash macos/install.sh
    elif test "$(uname)" = "Linux"; then
        sudo bash linux/install.sh
    else
        echo "os must be darwin (macos) or linux"
        exit 1
    fi
fi

### run setup.sh files
for file in $(find -H "$DOTFILES_ROOT" -maxdepth 2 -name 'setup.sh' -not -path '*.git*'); do
    echo "    Would you like to run $file? (y/n): "
    read input
    input="${input:0:1}"
    if [ "$input" = "y" ]; then
        bash $file
    fi
done

### symlink dotfiles
./link
